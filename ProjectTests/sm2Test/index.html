<html>
    <head>
        <title>Mushuk: Uzbek for Cat</title>
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <style>
            .center {
                text-align: center;
                margin: auto;
                width: 60%;
                padding: 10px;
            }
        </style>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <script src="//connect.soundcloud.com/sdk-2.0.0.js"></script>
        <script type="text/javascript" src="soundmanager/script/soundmanager2.js"></script>
        <script type="text/javascript">

            var cid     = '9896695e978359ad6e39e1b98f22abb4';
            var ready   = false;
            var track_url;
            var currentSound;
            var latestSearchResults = [];

            SC.initialize({
              client_id: cid
            });

            soundManager.setup({
                flashVersion: 9, // optional: shiny features (default = 8)
                preferFlash: false,
                onready: function() {
                    ready       = true; //I'm assuming soundManager just has a ready property.
                    track_url   = 'https://soundcloud.com/hadouken/hadouken-bliss-out-1';
                }
            });

            function StartTrack(trackNumber){
                soundManager.stop('currentSound');
                soundManager.destroySound("currentSound");

                var track = latestSearchResults[trackNumber];
                var art = track.artwork_url;
                art = art.replace("-large", '-crop');
                document.getElementById("album_art").src = art;
                document.getElementById("song_name").innerHTML = track.title;
                document.getElementById("user_name").innerHTML = track.user.username;

                currentSound = soundManager.createSound({
                    id: "currentSound", // optional: provide your own unique id
                    url: track.stream_url + '?client_id=' + cid,
                    autoLoad: true,
                    autoPlay: true,
                    multiShot: false,
                    multiShotEvents: false,
                    whileplaying: function() {
                            document.getElementById('song_progress').value = this.position/this.duration;
                    }
                });

                document.getElementById("play_button").innerHTML = "Pause";
            }

            function TogglePlay(){
                currentSound.togglePause();
                if(currentSound.paused){
                    document.getElementById("play_button").innerHTML = "Play";
                }
                else{
                    document.getElementById("play_button").innerHTML = "Pause";
                }
            }

            function Search(){
                var query = document.getElementById("search").value;

                SC.get('/tracks', { q: query}, function(tracks) {
                  console.log(tracks);
                  latestSearchResults.length = 0;
                  latestSearchResults = tracks;
                  $("#search_results").empty();
                  for (var i=0; i<tracks.length; i++) {
                      RenderSearchResult(i,tracks[i]);
                  };
                });
            }

            function RenderSearchResult(resultNum,track){
                var id      = track.id;
                var title   = "<h4>" + track.title + "</h4>";
                var user    = "<h5>" + track.user.username + "</h5>";

                var panel = $('<div></div')
                .appendTo($("#search_results"))
                .attr('class', "panel panel-default")
                .bind('click', function(){StartTrack(resultNum);});

                var panelBody = $('<div></div>')
                .appendTo(panel)
                .attr('class',"panel-body")

                panelBody.append(title + user);
            }

        </script>
    </head>

    <body style="background-color:#222222">
        <h1 class="center" style="color: lightgrey; ">Mushuk</h1>
        <div class="container">
            <div class="jumbotron">
                <img id="album_art" src="http://gfm.fm/assets/img/default-albumart.png" alt="Album Art" style="border: 5px solid grey"/>
                <h3 id="song_name">Song</h3>
                <h4 id="user_name">Artist</h4>
                <button id="play_button" onclick="TogglePlay()">Play</button>
                <button onclick="soundManager.stop('currentSound')">Stop</button>
                <progress id="song_progress" value="0" max="1"></progress>
            </div>
        </div>
        <hr/>

        <div class="container">
            <h3 style="color: lightgrey">Search</h3>
            <input type="text" name="search" id="search"/>
            <button onclick="Search()">Find Song!</button>
            <hr/>
            <div id="search_results" class="container">
                
            </div>
        </div>
    </body>
</html>